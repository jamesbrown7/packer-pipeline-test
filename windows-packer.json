{
  "_comment" : "Simple Packer Template using Windows Server 2012R2",
  "builders": [{
    "type": "amazon-ebs",
    "region": "us-west-2",
    "source_ami": "ami-f318de8b",
    "instance_type": "t2.small",
    "ssh_username": "ec2-user",
    "ami_name": "helloworld-windows {{timestamp}}",
    "user_data_file":"./ec2-userdata.ps1",
    "communicator": "winrm",
    "winrm_username": "Administrator",
    "winrm_use_ssl": true,
    "winrm_insecure": true
  }],
  "provisioners": [
    {
      "type": "powershell",
      "inline": [
        "Set-ExecutionPolicy -Force Bypass; Invoke-WebRequest -URI https://s3.amazonaws.com/aws-cli/AWSCLI64.msi -Outfile C:/Windows/Temp/AWSCLI64.msi",
        "C:/Windows/Temp/AWSCLI64.msi -passive -quiet"
      ]
    },
    {
      "type": "shell-local",
      "command": "sleep 30"
    },
    {
      "type": "powershell",
      "inline": [
        "$Env:Path += \";\" + \"C:\\Program Files\\Amazon\\cfn-bootstrap\\;C:\\Program Files\\Amazon\\AWSCLI\\\"",
        "$Env:Path",
        "$Env:PsModulePath := \";\" + \"C:\\Program Files (x86)\\AWS Tools/PowerShell\\\"",
        "$Env:PsModulePath",
        "aws s3 cp s3://com.nuovo.gw.winpacker.test/SourceTree_2.5.1a.zip c:\\Windows\\Temp",
        "C:\\Program Files\\Amazon\\AWSCLI\\aws s3 cp s3://com.nuovo.gw.winpacker.test/SourceTree_2.5.1a.zip c:\\Windows\\Temp"
      ]
    }
  ]
}
